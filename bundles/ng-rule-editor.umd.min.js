!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("@angular/common"),require("@angular/forms"),require("@angular/cdk/drag-drop"),require("@angular/platform-browser/animations"),require("@angular/material/radio"),require("math-to-fhirpath")):"function"==typeof define&&define.amd?define("ng-rule-editor",["exports","@angular/core","rxjs","@angular/common","@angular/forms","@angular/cdk/drag-drop","@angular/platform-browser/animations","@angular/material/radio","math-to-fhirpath"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["ng-rule-editor"]={},e.ng.core,e.rxjs,e.ng.common,e.ng.forms,e.ng.cdk.dragDrop,e.ng.platformBrowser.animations,e.ng.material.radio,e.mathToFhirpath)}(this,(function(e,t,n,i,r,o,a,s,l){"use strict";function c(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var u=c(t),p=c(l);Object.create;function d(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],i=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&i>=e.length&&(e=void 0),{value:e&&e[i++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}Object.create;var h={kg:[{unit:"lbs",factor:2.20462}],lbs:[{unit:"kg",factor:.453592}],"[in_i]":[{unit:"cm",factor:2.54},{unit:"m",factor:.0254}]},v=function(){function e(){this.syntaxType="simple",this.uneditableVariablesChange=new n.Subject,this.variablesChange=new n.Subject,this.questionsChange=new n.Subject,this.mightBeScoreChange=new n.Subject,this.finalExpressionChange=new n.Subject,this.LANGUAGE_FHIRPATH="text/fhirpath",this.QUESTION_REGEX=/^%resource\.item\.where\(linkId='(.*)'\)\.answer\.value(?:\*(\d*\.?\d*))?$/,this.VARIABLE_EXTENSION="http://hl7.org/fhir/StructureDefinition/variable",this.CALCULATED_EXPRESSION="http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-calculatedExpression",this.linkIdToQuestion={},this.mightBeScore=!1,this.variables=[],this.uneditableVariables=[]}return e.prototype.addVariable=function(){var e=this.variables.map((function(e){return e.label})).concat(this.uneditableVariables.map((function(e){return e.name})));this.variables.push({label:this.getNewLabelName(e),type:"question",expression:""}),this.variablesChange.next(this.variables)},e.prototype.remove=function(e){this.variables.splice(e,1)},e.prototype.getUneditableVariables=function(e){return Array.isArray(e.extension)?e.extension.reduce((function(e,t){var n,i;if("http://hl7.org/fhir/StructureDefinition/questionnaire-launchContext"===t.url&&t.extension){var r={name:t.extension.find((function(e){return"name"===e.url})).valueId,type:null===(n=t.extension.filter((function(e){return"type"===e.url})))||void 0===n?void 0:n.map((function(e){return e.valueCode})).join("|"),description:null===(i=t.extension.find((function(e){return"description"===e.url})))||void 0===i?void 0:i.valueString};e.push(r)}return e}),[]):[]},e.prototype.extractVariables=function(e){var t=this;if(e.extension){var n=[],i=[];return e.extension.forEach((function(e){e.url===t.VARIABLE_EXTENSION&&e.valueExpression&&e.valueExpression.language===t.LANGUAGE_FHIRPATH?n.push(t.processVariable(e.valueExpression.name,e.valueExpression.expression)):i.push(e)})),e.extension=i,n}return[]},e.prototype.itemHasScore=function(e){return"string"==typeof e&&(e=this.linkIdToQuestion[e]),(e.answerOption||[]).some((function(e){return(e.extension||[]).some((function(e){return"http://hl7.org/fhir/StructureDefinition/ordinalValue"===e.url}))}))},e.prototype.isProbablyScore=function(e,t){var n=this,i=e.item.length,r=0;return e.item.forEach((function(e){e.linkId===t?i--:n.itemHasScore(e)&&r++})),r/i>=.6},e.prototype.import=function(e,t){if(this.linkIdContext=t,this.fhir=e,"Questionnaire"===e.resourceType&&e.item&&e.item.length){this.mightBeScore=this.isProbablyScore(e,t),this.mightBeScoreChange.next(this.mightBeScore),this.uneditableVariables=this.getUneditableVariables(e),this.uneditableVariablesChange.next(this.uneditableVariables),this.linkIdToQuestion={};var n=this.linkIdToQuestion;for(var i in this.processItem(e.item),this.variables=this.extractVariables(e),this.variablesChange.next(this.variables),this.questions=[],n){if(!n.hasOwnProperty(i))return;var r=n[i],o=r.text;this.questions.push({linkId:r.linkId,text:o.length>60?o.substring(0,60)+"...":o,unit:this.getQuestionUnits(r.linkId)})}this.questionsChange.next(this.questions),this.finalExpression=this.extractFinalExpression(e.item,t),this.finalExpressionChange.next(this.finalExpression)}},e.prototype.processItem=function(e){var t=this;e.forEach((function(e){t.linkIdToQuestion[e.linkId]=e,e.item&&t.processItem(e.item)}))},e.prototype.extractFinalExpression=function(e,t){var n,i,r=this;try{for(var o=d(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.extension){var l=s.extension.findIndex((function(e){return e.url===r.CALCULATED_EXPRESSION&&e.valueExpression.language===r.LANGUAGE_FHIRPATH&&e.valueExpression.expression}));if(-1!==l){var c=s.extension[l].valueExpression.expression;return s.extension.splice(l,1),c}}else if(s.item)return this.extractFinalExpression(s.item,t)}}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}return""},e.prototype.processVariable=function(e,t){var n=t.match(this.QUESTION_REGEX);if(null!==n){var i=n[1],r=n[2],o={label:e,type:"question",linkId:i,expression:t};if(r){var a=this.getQuestionUnits(i);if(h.hasOwnProperty(a)){var s=h[a].find((function(e){return e.factor.toString()===r}));o.unit=s.unit}}return o}return{label:e,type:"expression",expression:t}},e.prototype.getQuestionUnits=function(e){var t=this.linkIdToQuestion[e];if(t.extension){var n=t.extension.find((function(e){return"http://hl7.org/fhir/StructureDefinition/questionnaire-unit"===e.url&&e.valueCoding.system&&"http://unitsofmeasure.org"===e.valueCoding.system}));if(n&&n.valueCoding.code)return n.valueCoding.code}return null},e.prototype.getNewLabelName=function(e){var t,n,i,r,o="abcdefghijklmnopqrstuvwxyz".split(""),a=[""].concat(o);try{for(var s=d(a),l=s.next();!l.done;l=s.next()){var c=l.value,u=function(t){var n=c+t;if(0===e.filter((function(e){return e===n})).length)return{value:n}};try{for(var p=(i=void 0,d(o)),h=p.next();!h.done;h=p.next()){var v=u(h.value);if("object"==typeof v)return v.value}}catch(e){i={error:e}}finally{try{h&&!h.done&&(r=p.return)&&r.call(p)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return""},e.prototype.toggleMightBeScore=function(){this.mightBeScore=!this.mightBeScore,this.mightBeScoreChange.next(this.mightBeScore)},e.prototype.export=function(e){var t=this,n=JSON.parse(JSON.stringify(this.fhir)),i=this.variables.map((function(e){return{url:t.VARIABLE_EXTENSION,valueExpression:{name:e.label,language:t.LANGUAGE_FHIRPATH,expression:e.expression}}}));n.extension?n.extension=n.extension.concat(i):n.extension=i;var r={url:this.CALCULATED_EXPRESSION,valueExpression:{language:this.LANGUAGE_FHIRPATH,expression:e}};return this.insertExtensions(n.item,this.linkIdContext,[r]),n},e.prototype.addTotalScoreRule=function(e,t){return this.fhir=e,this.linkIdContext=t,this.exportSumOfScores()},e.prototype.exportSumOfScores=function(){var e=this,t=this.fhir,n=this.linkIdContext,i=[],r=[];t.item.forEach((function(t){t.linkId!==n&&e.itemHasScore(t)&&r.push(t.linkId)})),r.forEach((function(){i.push(e.getNewLabelName(i))}));var o=r.map((function(t,n){return{url:e.VARIABLE_EXTENSION,valueExpression:{name:i[n],language:e.LANGUAGE_FHIRPATH,expression:"%questionnaire.item.where(linkId = '"+t+"').answerOption.where(valueCoding.code=%resource.item.where(linkId = '"+t+"').answer.valueCoding.code).extension.where(url='http://hl7.org/fhir/StructureDefinition/ordinalValue').value"}}})),a={url:this.VARIABLE_EXTENSION,valueExpression:{name:"any_questions_answered",language:this.LANGUAGE_FHIRPATH,expression:i.map((function(e){return"%"+e+".exists()"})).join(" or ")}},s=i.map((function(e){return"iif(%"+e+".exists(), %"+e+", 0)"})).join(" + "),l={url:this.CALCULATED_EXPRESSION,valueExpression:{description:"Total score calculation",language:this.LANGUAGE_FHIRPATH,expression:"iif(%any_questions_answered, "+s+", {})"}};return o.push(a),o.push(l),this.insertExtensions(t.item,n,o),t},e.prototype.insertExtensions=function(e,t,n){var i,r;try{for(var o=d(e),a=o.next();!a.done;a=o.next()){var s=a.value;if(s.linkId===t){s.extension?s.extension=s.extension.concat(n):s.extension=n;break}s.item&&this.insertExtensions(s.item,t,n)}}catch(e){i={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}},e.prototype.valueOrScoreExpression=function(e,t,n,i,r){return t?"%questionnaire.item.where(linkId = '"+e+"').answerOption.where(valueCoding.code=%resource.item.where(linkId = '"+e+"').answer.valueCoding.code).extension.where(url='http://hl7.org/fhir/StructureDefinition/ordinalValue').value":n&&i&&r?"%resource.item.where(linkId='"+e+"').answer.value*"+h[i].find((function(e){return e.unit===r})).factor:"%resource.item.where(linkId='"+e+"').answer.value"},e}();v.ɵprov=u.ɵɵdefineInjectable({factory:function(){return new v},token:v,providedIn:"root"}),v.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],v.ctorParameters=function(){return[]};var f,b=function(){function e(e){this.variableService=e,this.fhirQuestionnaire=null,this.itemLinkId=null,this.submitButtonName="Submit",this.save=new t.EventEmitter,this.advancedInterface=!0,this.datePipe=new i.DatePipe("en-US"),this.suggestions=[]}return e.prototype.ngDestroy=function(){this.calculateSumSubscription.unsubscribe(),this.finalExpressionSubscription.unsubscribe(),this.variablesSubscription.unsubscribe()},e.prototype.ngOnChanges=function(){this.reload()},e.prototype.reload=function(){var e=this;null!==this.fhirQuestionnaire&&null!==this.itemLinkId&&this.variableService.import(this.fhirQuestionnaire,this.itemLinkId),this.linkIdContext=this.variableService.linkIdContext,this.expressionSyntax=this.variableService.syntaxType,this.calculateSum=this.variableService.mightBeScore,this.calculateSumSubscription=this.variableService.mightBeScoreChange.subscribe((function(t){e.calculateSum=t})),this.finalExpression=this.variableService.finalExpression,this.finalExpressionSubscription=this.variableService.finalExpressionChange.subscribe((function(t){e.finalExpression=t})),this.variables=this.variableService.variables.map((function(e){return e.label})),this.variablesSubscription=this.variableService.variablesChange.subscribe((function(t){e.variables=t.map((function(e){return e.label}))}))},e.prototype.import=function(e){var t=this;if(e.target.files&&e.target.files[0]){var n=new FileReader;n.onload=function(e){if("string"==typeof e.target.result)try{var n=JSON.parse(e.target.result);t.variableService.import(n,t.linkIdContext)}catch(e){console.error("Could not parse file",e)}else console.error("Could not read file")},n.readAsText(e.target.files[0])}e.target.value=""},e.prototype.export=function(){this.save.emit(this.variableService.export(this.finalExpression))},e.prototype.exportSumOfScores=function(){this.save.emit(this.variableService.exportSumOfScores())},e.prototype.downloadAsFile=function(e,t){var n=new Blob([JSON.stringify(e,null,2)]),i=this.datePipe.transform(Date.now(),"yyyyMMdd-hhmmss");if(t=t||"fhirpath-"+i+".json",window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(n,t);else{var r=window.URL.createObjectURL(n),o=document.createElement("a");o.setAttribute("style","display: none"),o.href=r,o.download=t,o.click(),window.URL.revokeObjectURL(r),o.remove()}},e.prototype.onSyntaxChange=function(e){var t=e.value;"simple"===t&&(this.finalExpression=""),this.variableService.syntaxType=t},e.prototype.updateFinalExpression=function(e){this.finalExpression=e},e}();b.decorators=[{type:t.Component,args:[{selector:"lhc-rule-editor",template:'<lhc-calculate-sum-prompt *ngIf="calculateSum" (export)="exportSumOfScores()"></lhc-calculate-sum-prompt>\n<div *ngIf="!calculateSum">\n  <h1>{{titleName}}</h1>\n\n  <section id="uneditable-variables-section" class="mb-3">\n    <lhc-uneditable-variables></lhc-uneditable-variables>\n  </section>\n\n  <section id="variables-section" class="mb-3">\n    <lhc-variables [advancedInterface]="advancedInterface"></lhc-variables>\n  </section>\n\n  <section id="final-expression-section" class="mb-3">\n    <h2>Final Expression</h2>\n\n\x3c!--    <div *ngIf="advancedInterface">--\x3e\n\x3c!--      <mat-radio-group [(ngModel)]="expressionSyntax" (change)="onSyntaxChange($event)" aria-label="Select an option">--\x3e\n\x3c!--        <mat-radio-button value="simple">Simple Expression Syntax</mat-radio-button>--\x3e\n\x3c!--        <mat-radio-button value="fhirpath">FHIRPath Expression Syntax</mat-radio-button>--\x3e\n\x3c!--      </mat-radio-group>--\x3e\n\x3c!--    </div>--\x3e\n\n    <div class="container">\n      <div class="row form-group">\n        <div class="col-md-3">\n          <div class="form-inline">\n            <select class="form-control" [(ngModel)]="expressionSyntax" aria-label="Expression syntax type">\n              <option value="simple">Simple Expression</option>\n              <option value="fhirpath">FHIRPath Expression</option>\n            </select>\n          </div>\n        </div>\n        <div class="col-md-9" [ngSwitch]="expressionSyntax">\n          <lhc-syntax-converter [variables]="variables" *ngSwitchCase="\'simple\'" (expressionChange)="updateFinalExpression($event)" class="form-inline"></lhc-syntax-converter>\n          <input aria-label="FHIRPath" *ngSwitchCase="\'fhirpath\'" id="final-expression" class="form-control" [(ngModel)]="finalExpression">\n        </div>\n      </div>\n    </div>\n    <div *ngIf="suggestions.length">{{suggestions|json}}</div>\n  </section>\n\n  <button class="btn btn-primary py-2 px-5" (click)="export()" id="export">{{submitButtonName}}</button>\n</div>\n',styles:['.toolbar-button{height:2.7rem}.file-import{width:4.6rem;color:transparent}.file-import::-webkit-file-upload-button{visibility:hidden}.file-import:before{content:"Import";display:inline-block;cursor:pointer;color:#fff}mat-radio-button{margin-left:1em}']}]}],b.ctorParameters=function(){return[{type:v}]},b.propDecorators={fhirQuestionnaire:[{type:t.Input}],itemLinkId:[{type:t.Input}],submitButtonName:[{type:t.Input}],titleName:[{type:t.Input}],save:[{type:t.Output}]},function(e){e.question="Question",e.expression="FHIRPath Expression",e.simple="Simple Expression"}(f||(f={}));var m=function(){function e(e){this.ruleEditorService=e,this.variableType=f,this.levels=[{level:0,name:"Top Level Scope"}]}return e.prototype.ngOnInit=function(){var e=this;this.variables=this.ruleEditorService.variables,this.variableSubscription=this.ruleEditorService.variablesChange.subscribe((function(t){e.variables=t}))},e.prototype.ngDestroy=function(){this.variableSubscription.unsubscribe()},e.prototype.onAdd=function(){this.ruleEditorService.addVariable()},e.prototype.onRemove=function(e){this.ruleEditorService.remove(e)},e.prototype.drop=function(e){o.moveItemInArray(this.variables,e.previousIndex,e.currentIndex)},e.prototype.getAvailableVariables=function(e){var t=this.ruleEditorService.uneditableVariables.map((function(e){return e.name})),n=this.variables.map((function(e){return e.label})).slice(0,e);return t.concat(n)},e}();m.decorators=[{type:t.Component,args:[{selector:"lhc-variables",template:'<h2>Variables</h2>\n\n<div class="container">\n  <div class="row font-weight-bold mb-2" aria-hidden="true">\n    <div class="col-md-2">Label</div>\n    <div class="col-md-3">Type</div>\n    <div class="col-md-7">Question/FHIRPath Expression</div>\n  </div>\n  <div cdkDropList (cdkDropListDropped)="drop($event)">\n    <div class="variable-row drag-variable row py-2" *ngFor="let variable of variables; index as i" [id]="\'row-\' + i" cdkDrag>\n      <div class="col-md-2 form-inline">\n        \x3c!-- Inline SVG for the row drag and drop handle --\x3e\n        <svg cdkDragHandle xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-grip-vertical mr-2 handle" viewBox="0 0 16 16">\n          <path d="M7 2a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 5a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM7 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-3 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>\n        </svg>\n        <input [id]="\'variable-label-\' + i" [(ngModel)]="variable.label" class="form-control w-75" aria-label="Variable label" />\n      </div>\n      <div class="col-md-3">\n        <div class="form-inline">\n          <select [id]="\'variable-type-\' + i" class="form-control" [(ngModel)]="variable.type" aria-label="Variable type">\n            <option value="" disabled hidden>Select...</option>\n            <option *ngFor="let type of variableType | keyvalue" value="{{type.key}}">{{type.value}}</option>\n          </select>\n        </div>\n      </div>\n      <div class="col-md-6" [ngSwitch]="variable.type">\n        <lhc-question [variable]="variable" [advancedInterface]="advancedInterface" *ngSwitchCase="\'question\'"></lhc-question>\n        <div class="form-inline" *ngSwitchCase="\'simple\'">\n          <input [id]="\'variable-expression-\' + i" [(ngModel)]="variable.simple" class="form-control mr-2 w-100"\n                 aria-label="Simple Expression" />\n          <lhc-syntax-preview [syntax]="variable.simple | mathToFhirpath:getAvailableVariables(i)"></lhc-syntax-preview>\n        </div>\n        <div class="form-inline" *ngSwitchCase="\'expression\'">\n          <input [id]="\'variable-expression-\' + i" [(ngModel)]="variable.expression" class="form-control mr-2 w-100"\n                 aria-label="FHIRPath Expression" />\n        </div>\n      </div>\n      <div class="col-md-1">\n        <button class="btn btn-danger remove-variable" aria-label="Remove Line" (click)="onRemove(i)">x</button>\n      </div>\n    </div>\n    <div *ngIf="!variables.length" class="py-2">No variables, please <a href="#" (click)="onAdd()">add one</a>.</div>\n  </div>\n</div>\n\n<button id="add-variable" class="btn btn-secondary mt-2" (click)="onAdd()">Add variable</button>\n',styles:[".example-list{width:500px;max-width:100%;border:1px solid #ccc;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden}.drag-variable{padding:20px 10px;border-top:1px solid rgba(0,0,0,.1);color:rgba(0,0,0,.87);display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;background:#fff}.handle{cursor:move}.cdk-drag-preview{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px rgba(0,0,0,.2),0 8px 10px 1px rgba(0,0,0,.14),0 3px 14px 2px rgba(0,0,0,.12)}.cdk-drag-placeholder{opacity:0}.cdk-drag-animating{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box:last-child{border:none}.example-list.cdk-drop-list-dragging .example-box:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}]}],m.ctorParameters=function(){return[{type:v}]},m.propDecorators={advancedInterface:[{type:t.Input}]};var x=function(){function e(e){this.variableService=e}return e.prototype.ngOnInit=function(){var e=this;this.uneditableVariables=this.variableService.uneditableVariables,this.uneditableVariablesSubscription=this.variableService.uneditableVariablesChange.subscribe((function(t){e.uneditableVariables=t}))},e.prototype.ngDestroy=function(){this.uneditableVariablesSubscription.unsubscribe()},e}();x.decorators=[{type:t.Component,args:[{selector:"lhc-uneditable-variables",template:'<div *ngIf="uneditableVariables.length">\n  <h2>Un-editable Variables</h2>\n\n  <div class="container mb-4">\n    <div class="row font-weight-bold" aria-hidden="true">\n      <div class="col-2">Label</div>\n      <div class="col-2">Type</div>\n      <div class="col-8">Description</div>\n    </div>\n    <hr>\n    <div class="row" *ngFor="let variable of uneditableVariables">\n      <div class="col-2"><span class="sr-only">Label</span>{{variable.name}}</div>\n      <div class="col-2"><span class="sr-only">Label</span>{{variable.type}}</div>\n      <div class="col-8"><span class="sr-only">Description</span>{{variable.description}}</div>\n    </div>\n  </div>\n</div>\n'}]}],x.ctorParameters=function(){return[{type:v}]};var g=function(){function e(e){this.variableService=e,this.linkId="",this.itemHasScore=!1,this.isNonConvertibleUnit=!1}return e.prototype.ngOnInit=function(){var e=this;this.linkId=this.variable.linkId?this.variable.linkId:"",this.toUnit=this.variable.unit?this.variable.unit:"",this.questions=this.variableService.questions,this.onChange(!1),this.variableService.questionsChange.subscribe((function(t){e.questions=t}))},e.prototype.getQuestion=function(e){return this.questions.find((function(t){return t.linkId===e}))},e.prototype.getConversionOptions=function(e){return h[e]},e.prototype.onChange=function(e){if(e&&(this.toUnit=""),this.linkId){var t=this.getQuestion(this.linkId);this.unit=null==t?void 0:t.unit,this.conversionOptions=this.getConversionOptions(this.unit),this.isNonConvertibleUnit=this.unit&&!this.conversionOptions,this.conversionOptions||this.isNonConvertibleUnit?this.itemHasScore=!1:this.itemHasScore=this.variableService.itemHasScore(this.linkId),this.variable.expression=this.variableService.valueOrScoreExpression(this.linkId,this.itemHasScore,!this.isNonConvertibleUnit,this.unit,this.toUnit)}},e}();g.decorators=[{type:t.Component,args:[{selector:"lhc-question",template:'<div class="form-inline">\n  <select class="question-select form-control mr-2 w-50" [(ngModel)]="linkId" (change)="onChange(true)" aria-label="Question">\n    <option value="" disabled hidden>Select...</option>\n    <option *ngFor="let question of questions" [value]="question.linkId">\n      {{question.text}}{{advancedInterface ? \' (\' + question.linkId + \')\' : \'\'}}\n    </option>\n  </select>\n\n  <select class="unit-select form-control" style="width: 40%" *ngIf="conversionOptions" [(ngModel)]="toUnit"\n          (change)="onChange(false)" aria-label="Unit conversion">\n    <option value="">Keep form units ({{unit}})</option>\n    <option *ngFor="let u of conversionOptions" value="{{u.unit}}">Convert to {{u.unit}}</option>\n  </select>\n  <span *ngIf="isNonConvertibleUnit">{{unit}}</span>\n  <span *ngIf="itemHasScore">Score</span>\n\n  <lhc-syntax-preview [syntax]="variable.expression"></lhc-syntax-preview>\n</div>\n'}]}],g.ctorParameters=function(){return[{type:v}]},g.propDecorators={variable:[{type:t.Input}],advancedInterface:[{type:t.Input}]};var y=function(){function e(e){this.ruleEditorService=e,this.export=new t.EventEmitter}return e.prototype.ngOnInit=function(){},e.prototype.onCloseClick=function(){this.ruleEditorService.toggleMightBeScore()},e.prototype.onExportClick=function(){this.export.emit()},e}();y.decorators=[{type:t.Component,args:[{selector:"lhc-calculate-sum-prompt",template:'<div class="score-modal">\n  <p>It looks like this might be a score calculation.</p>\n\n  <p>Would you like to calculate the sum of scores?</p>\n\n  <button class="btn btn-primary py-2 px-5 mx-2" (click)="onExportClick()" id="export-score">Yes</button>\n  <button class="btn btn-secondary py-2 px-5 mx-2" (click)="onCloseClick()" id="skip-export-score">No</button>\n</div>\n',styles:[".score-modal{text-align:center}"]}]}],y.ctorParameters=function(){return[{type:v}]},y.propDecorators={export:[{type:t.Output}]};var S=function(){function e(){}return e.prototype.transform=function(e,t){if(void 0!==e){var n=p.fhirconvert(e,t);if(null!==n)return n}return"Not valid"},e}();S.decorators=[{type:t.Pipe,args:[{name:"mathToFhirpath"}]}];var I=function(){function e(){this.expressionChange=new t.EventEmitter,this.jsToFhirPathPipe=new S}return e.prototype.ngOnInit=function(){},e.prototype.onExpressionChange=function(e){var t=this.jsToFhirPathPipe.transform(e,this.variables);this.fhirPathExpression=t,this.expressionChange.emit(t)},e}();I.decorators=[{type:t.Component,args:[{selector:"lhc-syntax-converter",template:'<input [(ngModel)]="expression" (ngModelChange)="onExpressionChange($event)"\n       class="form-control mr-2 w-100" id="simple-expression" aria-label="Simple Expression" />\n<lhc-syntax-preview [syntax]="fhirPathExpression" [showWhenEmpty]="true"></lhc-syntax-preview>\n',styles:[":host{width:100%}"]}]}],I.ctorParameters=function(){return[]},I.propDecorators={value:[{type:t.Input}],variables:[{type:t.Input}],expressionChange:[{type:t.Output}]};var E=function(){function e(){this.showWhenEmpty=!1}return e.prototype.ngOnInit=function(){},e}();E.decorators=[{type:t.Component,args:[{selector:"lhc-syntax-preview",template:'<div class="mt-2 syntax-preview text-muted" *ngIf="syntax || showWhenEmpty">\n  FHIRPath: <pre class="d-inline text-muted" title="{{syntax}}">{{syntax}}</pre>\n</div>\n',styles:[":host{overflow:hidden}.syntax-preview{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}]}],E.ctorParameters=function(){return[]},E.propDecorators={syntax:[{type:t.Input}],showWhenEmpty:[{type:t.Input}]};var w=function(){};w.decorators=[{type:t.NgModule,args:[{declarations:[b,m,x,g,y,S,I,E],imports:[r.FormsModule,a.BrowserAnimationsModule,o.DragDropModule,s.MatRadioModule],exports:[b]}]}],e.RuleEditorComponent=b,e.RuleEditorModule=w,e.RuleEditorService=v,e.ɵa=m,e.ɵb=x,e.ɵc=g,e.ɵd=y,e.ɵe=S,e.ɵf=I,e.ɵg=E,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ng-rule-editor.umd.min.js.map