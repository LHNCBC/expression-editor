<div>
  <div>
    @if (!multipleLines) {
      @if (index !== 'final') {
        <input
          [(ngModel)]="simple"
          [id]="'simple-expression-' + index"
          (ngModelChange)="onExpressionChange($event)"
          class="simple-expression"
          aria-label="Easy Path Expression Text Input"
          [style]="lhcStyle.input"
          [attr.aria-invalid]="hasError"
          aria-describedby="fhirpath-error"
          spellcheck="false"
          [class.field-error]="inputRef?.errors && !inputRef?.errors?.hasOwnProperty('invalidExpressionWarning')"
          [class.field-warning]="inputRef?.errors && inputRef?.errors?.hasOwnProperty('invalidExpressionWarning')"
          #inputRef="ngModel"
          lhcExpressionValidator
          [lhcExpressionValidateInput]="validateInput"
        [lhcExpressionValidatorParams]="{'section': (index === 'final') ? 'Output Expression' : 'Item Variables',
                                         'field': 'expression', 'type': 'simple', 'index': index,
                                         'variables' : variables}"
          />
      }
    } @else {
      @if (index === 'final') {
        <textarea
          row="1"
          [(ngModel)]="simple"
          [id]="'simple-expression-' + index"
          (ngModelChange)="onExpressionChange($event)"
          class="simple-expression textarea"
          aria-label="Easy Path Expression Text Input"
          [style]="lhcStyle.input"
          [attr.aria-invalid]="hasError"
          aria-describedby="fhirpath-error"
          spellcheck="false"
          [class.field-error]="inputRef?.errors"
          #inputRef="ngModel"
          lhcExpressionValidator
          [lhcExpressionValidateInput]="validateInput"
        [lhcExpressionValidatorParams]="{'section': (index === 'final') ? 'Output Expression' : 'Item Variables',
                                         'field': 'expression', 'type': 'simple', 'index': index,
                                         'variables' : variables}"
        ></textarea>
      }
    }


    @if (inputRef?.errors) {
      <div id="expression-audible-error" role="alert" class="visually-hidden" >
        {{inputRef?.errors.ariaMessage}}
      </div>
    }
    @if (inputRef?.errors) {
      <div id="expression-error" class="row error-span">
        @if (inputRef?.errors && !inputRef?.errors?.hasOwnProperty('invalidExpressionWarning')) {
          <p class="expression-error">
            {{inputRef?.errors.message}}
          </p>
        }
        @if (inputRef?.errors && inputRef?.errors?.hasOwnProperty('invalidExpressionWarning')) {
          <p class="expression-warning">
            {{inputRef?.errors.message}}
          </p>
        }
      </div>
    }

    @if (!inputRef?.errors) {
      <lhc-syntax-preview
        [syntax]="fhirPathExpression"
        [lhcStyle]="{'width': 'auto'}"
        [hasError]="hasError">
      </lhc-syntax-preview>
    }
  </div>
</div>